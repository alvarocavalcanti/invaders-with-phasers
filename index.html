<html>
	<head>
		<meta charset="UTF-8" />
        <title>Invaders, with PHASERS!</title>
		<script type="text/javascript" src="js/phaser.js"></script>
	    <style type="text/css">
	        body {
	            margin: 0;
	        }
	    </style>
	</head>

	<body>
	    <script type="text/javascript">

	    window.onload = function() {

	    	var game = new Phaser.Game(800, 600, Phaser.AUTO, 'invaders-with-phaser', {preload: preload, create: create, update: update});

	    	var ship;
	    	var cursors;
	    	var fireButton;
	    	var bullet;
	    	var bulletTime = 0;

	    	function preload () {
	    		game.load.spritesheet('ship','img/ship_24x25.png', 24, 25, 5);
	    		game.load.spritesheet('bullet','img/shot_14x14.png', 14, 14);
	    	}

	    	function create () {
	    		game.physics.startSystem(Phaser.Physics.ARCADE);

	    		ship = game.add.sprite(game.world.centerX, game.world.height - 50, 'ship');
	    		ship.anchor.setTo(0.5, 0.5);
	    		game.physics.enable(ship, Phaser.Physics.ARCADE);

	    		ship.animations.add('idle', [2]);
	    		ship.animations.add('left', [1,0]);
	    		ship.animations.add('right', [3,4]);

	    		ship.animations.play('idle', 15, true);

	    		ship.body.drag.setTo(200,200);

	    		cursors = game.input.keyboard.createCursorKeys();
	    		fireButton = game.input.keyboard.addKey(Phaser.Keyboard.SPACEBAR);
	    	}

	    	function update () {
	    		if (cursors.left.isDown) {
	    			ship.body.acceleration.x = -200;
	    			if (ship.animations.currentAnim.name != 'left')
	    				ship.animations.play('left', 15, false);
	    		} else if (cursors.right.isDown) {
	    			ship.body.acceleration.x = 200;
	    			if (ship.animations.currentAnim.name != 'right')
	    				ship.animations.play('right', 15, false);
	    		} else {
	    			ship.body.acceleration.x = 0;
	    			ship.animations.play('idle', 15, false);
	    		}

	    		if (fireButton.isDown) {
	    			shoot();
	    		}
	    	}

	    	function shoot () {
	    		if (game.time.now > bulletTime) {
		    		var bullet = game.add.sprite(ship.x, ship.y, 'bullet');
		    		bullet.anchor.setTo(0.5, 0.5);
		    		bullet.animations.add('glow');
		    		bullet.animations.play('glow', 30, true);
		    		game.physics.enable(bullet, Phaser.Physics.ARCADE);
		    		bullet.body.velocity.y = -300;
		    		bulletTime = game.time.now + 400;
	    		}
	    	}

	    };

	    </script>
	</body>
</html>